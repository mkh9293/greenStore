<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.store.greenStore.mapper.RvMapper">

    <insert id="insert" useGeneratedKeys="true" keyProperty="rkey">
        INSERT review(MKEY,SH_ID,RCONTENT,RELIKE,RDATE)
        VALUES (#{mkey}, #{sh_id}, #{rcontent},0,NOW())
    </insert>
	
	
    <update id="update">
  		UPDATE review SET rcontent=#{rcontent}, rdate=now() where rkey=#{rkey}

    </update>
	
	<delete id="delete">
		DELETE FROM review where rkey=#{rkey}
	</delete>
	
	<select id="select" resultType="com.store.greenStore.dto.Review">
		SELECT * FROM review WHERE sh_id=#{sh_id} and relike = (SELECT max(relike) FROM review);
	</select>
	
	<select id="listAll" resultType="com.store.greenStore.dto.Review"> 
		SELECT * FROM review r INNER JOIN store s ON r.sh_id = s.sh_id order by rkey asc;
	</select>
	
	<select id="oneStore" resultType="com.store.greenStore.dto.Review">
		SELECT * FROM review WHERE sh_id=#{sh_id}
	</select>
	
	<select id="reLike" >
		UPDATE review SET relike=relike+1 where rkey=#{rkey}
	</select>
	
	<select id="reUnlike">
		UPDATE review SET relike=relike-1 where rkey=#{rkey}
	</select>
	
	
</mapper>
