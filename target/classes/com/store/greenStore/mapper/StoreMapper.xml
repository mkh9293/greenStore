<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.store.greenStore.mapper.StoreMapper">

    <insert id="insert" useGeneratedKeys="true" keyProperty="sh_id">
        INSERT store(SH_ID,SH_NAME,SH_ADDR,INDUTY_CODE_SE,SH_PHONE,SH_WAY,SH_INFO,SH_PRIDE,SH_RCMN,SH_PHOTO,SH_LIKE,BASE_YM,induty_code_se_name)
        VALUES (#{sh_id}, #{sh_name}, #{sh_addr}, #{induty_code_se},#{sh_phone},#{sh_way},#{sh_info},#{sh_pride},#{sh_rcmn},#{sh_photo},#{sh_like},NOW(),#{induty_code_se_name})
    </insert>
	
	<select id="selectAll" resultType="com.store.greenStore.dto.Store">
		SELECT *
		FROM store
		ORDER BY sh_rcmn DESC LIMIT 6
	</select>
	
	<!-- 이름,주소,찾아오는길,자랑거리,메뉴에서 찾는 단어가 존재하는 행들을 뿌려준다. mysql에서 제공하는 full text search를 이용하기 위해서는 match, against 구문이 필요하다
		 concat을 사용한 이유는 *#{searchText}* 와 같이 * 특수문자를 붙이기 위해서 사용했고,
		  업소 이름을 기준으로 그룹을 만들었다.  -->
	<select id="selectById" resultType="com.store.greenStore.dto.Store">
			select distinct * 
			from store join store_menu on store.sh_id = store_menu.sh_id  
			where match(store.sh_name,store.sh_addr,store.sh_way,store.sh_pride,store_menu.menu) against(concat('*',#{searchText},'*') IN BOOLEAN MODE)
			group by sh_name
			order by store_menu.menu desc;
	</select>
	
</mapper>
